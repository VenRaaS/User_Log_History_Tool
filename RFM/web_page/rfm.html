<!DOCTYPE html>

<html>
	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<meta name="description" content="chart created using amCharts live editor" />

		<!-- amCharts javascript sources -->
		<script type="text/javascript" src="http://www.amcharts.com/lib/3/amcharts.js"></script>
		<script type="text/javascript" src="http://www.amcharts.com/lib/3/serial.js"></script>
		<!--load jquery & jquery UI-->
		<script src="https://ajax.aspnetcdn.com/ajax/jquery/jquery-2.1.4.min.js"></script>
		<script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>
		<link href="http://code.jquery.com/ui/1.11.4/themes/smoothness/jquery-ui.min.css" rel="stylesheet" type="text/css" />
		<link href="https://kidsysco.github.io/jquery-ui-month-picker/MonthPicker.min.css" rel="stylesheet" type="text/css" />
		
		<script src="http://code.jquery.com/jquery-1.12.1.min.js"></script>
		<script src="http://code.jquery.com/ui/1.11.4/jquery-ui.min.js"></script>
		<script src="https://kidsysco.github.io/jquery-ui-month-picker/MonthPicker.min.js"></script>
		<script src="https://cdn.rawgit.com/digitalBush/jquery.maskedinput/1.4.1/dist/jquery.maskedinput.min.js"></script>
		<script src="https://kidsysco.github.io/jquery-ui-month-picker/examples.js"></script>
		
		
		<!-- Bootstrap -->
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/css/bootstrap.min.css" type="text/css">
	    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/css/bootstrap-theme.min.css">
		<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/js/bootstrap.min.js"></script>
		<!-- D3 -->
		<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/4.3.0/d3.js"></script>
		
		<!--amchart setting-->
		<style type="text/css">
		#chartdiv {
			width: 100%;
			height: 1000px;
			font-size: 11px;
		}
		</style>
		<!--全景設計-->
		<style type="text/css">
			body {
				padding-top: 20px;
				padding-bottom: 40px;
				padding-left: 40px;
			}
			.sidebar-nav {
				padding: 5px 10;
			}
			.input-group{
				padding: 5px 0;
			}			
			table tr td{
			   padding:0px;
			   height:15px;
			   line-height:0px;
			}
			.ui-datepicker-calendar {
				display: none;
			}
		</style>
		
	</head>
	<body>
		<div class="row col-md-5">
			<div><h1>RFM 分群人數觀測 <small><i> [gohappy] </i></small></h1></div>
			<div>
				<font size="3"> 選擇月份 
					<input id="ChromeMonthPicker" type="month" class="">
					<input type="button" value="送出" id="updateMonth">
				</font>
			</div>
			</br><button class="btn btn-default" id="switch_btn">Count / 百分比 Switcher</button>
			
			<div style="color:blue">
				</br>
				<form>
					<label class="radio-inline"><input type="radio" name="optradio">R1</label>
					<label class="radio-inline"><input type="radio" name="optradio">R2</label>
					<label class="radio-inline"><input type="radio" name="optradio">R3</label>
					<label class="radio-inline"><input type="radio" name="optradio" checked="checked">All</label>
				</form>
				
				<form>
					<label class="radio-inline"><input type="radio" name="optradio">F1</label>
					<label class="radio-inline"><input type="radio" name="optradio">F2</label>
					<label class="radio-inline"><input type="radio" name="optradio">F3</label>
					<label class="radio-inline"><input type="radio" name="optradio" checked="checked">All</label>
				</form>
				
				<form>
					<label class="radio-inline"><input type="radio" name="optradio">M1</label>
					<label class="radio-inline"><input type="radio" name="optradio">M2</label>
					<label class="radio-inline"><input type="radio" name="optradio">M3</label>
					<label class="radio-inline"><input type="radio" name="optradio" checked="checked">All</label>
				</form>
			</div>
		</div>
		<div class="col-md-3">
			<h3>RFM分群定義</h3>
			<table class="table table-condensed" height="100px" style="font-size:10px">
				<tr>
				  <td></td>
				  <td class="active">1</td>
				  <td class="success">2</td>
				  <td class="warning">3</td>
				</tr>
				<tr>
				  <td><font size="3">R : 上次消費商品距今</font></td>
				  <td class="active">1個月內</td>
				  <td class="success">1個月~半年</td>
				  <td class="warning">半年以上</td>
				</tr>
				<tr>
				  <td><font size="3">F : 最近一年的下訂單頻率</font></td>
				  <td class="active"> > 1000 筆</td>
				  <td class="success">1000~100 筆</td>
				  <td class="warning"> < 100筆 </td>
				</tr>
				<tr>
				  <td><font size="3">M: 最近一年的購買金額總合</font></td>
				  <td class="active"> > 100萬</td>
				  <td class="success"> 5 ~ 100萬</td>
				  <td class="warning"> < 5萬 </td>
				</tr>
			</table>
		</div>
		<div class="col-md-3">
			</br></br>
			<h4>
			<div>訂單計算期間 : 近一年</div></br>
			<div>重新分組時間 : 每個月月初</div></br>
			<div>計算單位     : count(每日上線uid)</div></br>
			<div>new_user     : 一年內沒有在weblog出現的uid</div>
			</h4>
		</div>
		</div>
		
		
		<!--
		<div><input type="button" value="ggg" id="ggg"></div>
		<div><input type="button" value="ttt" id="ttt"></div>
		-->
		
		
		<div id="chartdiv1" style="width: 90%; height: 500px; background-color: #FFFFFF;" ></div>
		<div><h3>HitRate</h3></div>
		<div id="chartdiv2" style="width: 90%; height: 500px; background-color: #FFFFFF;" ></div>		
				
		<!-- amCharts javascript code -->
		<script type="text/javascript">
		function showplot(data){
			var chart = AmCharts.makeChart("chartdiv1", {
			"type": "serial",
			"theme": "light",
			"marginRight": 40,
			"marginLeft": 40,
			"autoMarginOffset": 20,
			"mouseWheelZoomEnabled":true,
			"dataProvider":jsondata, //只能傳進json object
			"legend": {
						"enabled": true,
						"useGraphSettings": true,
						"valueWidth":35,
						"horizontalGap": 10,
						"markerSize": 10,
						"clickMarker": handleLegendClick, //marker指的是前面的圖案
						//"clickLabel": handleLegendClick   //label指的是文字標籤
					},
			
			"dataDateFormat": "YYYY-MM-DD",
			"valueAxes": [{
				"id": "v1",
				"axisAlpha": 0,
				"position": "left",
				"ignoreAxisWidth":true
			}],
			"balloon": {
				"borderThickness": 0.5,
				"shadowAlpha": 0,
				"cornerRadius": 1,
			},
			"graphs": [{
				"id": "r1_f1_m1",
				"balloon":{
				  "drop":false,
				  "adjustBorderColor":false,
				  "color":"#ffffff"
				},
				"bullet": "round",
				"bulletBorderAlpha": 1,
				"bulletColor": "#FFFFFF",
				"bulletSize": 7,
				"hideBulletsCount": 50,
				"lineThickness": 1,
				"title": "r1_f1_m1",
				"useLineColorForBulletBorder": true,
				"valueField": "r1_f1_m1",
				"balloonText": "<span style='font-size:8px;'>[[value]]</span>"
			},{
				"id": "r1_f1_m2",
				"balloon":{
				  "drop":false,
				  "adjustBorderColor":false,
				  "color":"#ffffff"
				},
				"bullet": "round",
				"bulletBorderAlpha": 1,
				"bulletColor": "#FFFFFF",
				"bulletSize": 7,
				"hideBulletsCount": 50,
				"lineThickness": 1,
				"title": "r1_f1_m2",
				"useLineColorForBulletBorder": true,
				"valueField": "r1_f1_m2",
				"balloonText": "<span style='font-size:8px;'>[[value]]</span>"
			},{
				"id": "r1_f1_m3",
				"balloon":{
				  "drop":false,
				  "adjustBorderColor":false,
				  "color":"#ffffff"
				},
				"bullet": "round",
				"bulletBorderAlpha": 1,
				"bulletColor": "#FFFFFF",
				"bulletSize": 7,
				"hideBulletsCount": 50,
				"lineThickness": 1,
				"title": "r1_f1_m3",
				"useLineColorForBulletBorder": true,
				"valueField": "r1_f1_m3",
				"balloonText": "<span style='font-size:8px;'>[[value]]</span>"
			},{
				"id": "r1_f2_m1",
				"balloon":{
				  "drop":false,
				  "adjustBorderColor":false,
				  "color":"#ffffff"
				},
				"bullet": "round",
				"bulletBorderAlpha": 1,
				"bulletColor": "#FFFFFF",
				"bulletSize": 7,
				"hideBulletsCount": 50,
				"lineThickness": 1,
				"title": "r1_f2_m1",
				"useLineColorForBulletBorder": true,
				"valueField": "r1_f2_m1",
				"balloonText": "<span style='font-size:8px;'>[[value]]</span>"
			},{
				"id": "r1_f2_m2",
				"balloon":{
				  "drop":false,
				  "adjustBorderColor":false,
				  "color":"#ffffff"
				},
				"bullet": "round",
				"bulletBorderAlpha": 1,
				"bulletColor": "#FFFFFF",
				"bulletSize": 7,
				"hideBulletsCount": 50,
				"lineThickness": 1,
				"title": "r1_f2_m2",
				"useLineColorForBulletBorder": true,
				"valueField": "r1_f2_m2",
				"balloonText": "<span style='font-size:8px;'>[[value]]</span>"
			},{
				"id": "r1_f2_m3",
				"balloon":{
				  "drop":false,
				  "adjustBorderColor":false,
				  "color":"#ffffff"
				},
				"bullet": "round",
				"bulletBorderAlpha": 1,
				"bulletColor": "#FFFFFF",
				"bulletSize": 7,
				"hideBulletsCount": 50,
				"lineThickness": 1,
				"title": "r1_f2_m3",
				"useLineColorForBulletBorder": true,
				"valueField": "r1_f2_m3",
				"balloonText": "<span style='font-size:8px;'>[[value]]</span>"
			},{
				"id": "r1_f3_m1",
				"balloon":{
				  "drop":false,
				  "adjustBorderColor":false,
				  "color":"#ffffff"
				},
				"bullet": "round",
				"bulletBorderAlpha": 1,
				"bulletColor": "#FFFFFF",
				"bulletSize": 7,
				"hideBulletsCount": 50,
				"lineThickness": 1,
				"title": "r1_f3_m1",
				"useLineColorForBulletBorder": true,
				"valueField": "r1_f3_m1",
				"balloonText": "<span style='font-size:8px;'>[[value]]</span>"
			},{
				"id": "r1_f3_m2",
				"balloon":{
				  "drop":false,
				  "adjustBorderColor":false,
				  "color":"#ffffff"
				},
				"bullet": "round",
				"bulletBorderAlpha": 1,
				"bulletColor": "#FFFFFF",
				"bulletSize": 7,
				"hideBulletsCount": 50,
				"lineThickness": 1,
				"title": "r1_f3_m2",
				"useLineColorForBulletBorder": true,
				"valueField": "r1_f3_m2",
				"balloonText": "<span style='font-size:8px;'>[[value]]</span>"
			},{
				"id": "r1_f3_m3",
				"balloon":{
				  "drop":false,
				  "adjustBorderColor":false,
				  "color":"#ffffff"
				},
				"bullet": "round",
				"bulletBorderAlpha": 1,
				"bulletColor": "#FFFFFF",
				"bulletSize": 7,
				"hideBulletsCount": 50,
				"lineThickness": 1,
				"title": "r1_f3_m3",
				"useLineColorForBulletBorder": true,
				"valueField": "r1_f3_m3",
				"balloonText": "<span style='font-size:8px;'>[[value]]</span>"
			},{
				"id": "r2_f1_m1",
				"balloon":{
				  "drop":false,
				  "adjustBorderColor":false,
				  "color":"#ffffff"
				},
				"bullet": "round",
				"bulletBorderAlpha": 1,
				"bulletColor": "#FFFFFF",
				"bulletSize": 7,
				"hideBulletsCount": 50,
				"lineThickness": 1,
				"title": "r2_f1_m1",
				"useLineColorForBulletBorder": true,
				"valueField": "r2_f1_m1",
				"balloonText": "<span style='font-size:8px;'>[[value]]</span>"
			},{
				"id": "r2_f1_m2",
				"balloon":{
				  "drop":false,
				  "adjustBorderColor":false,
				  "color":"#ffffff"
				},
				"bullet": "round",
				"bulletBorderAlpha": 1,
				"bulletColor": "#FFFFFF",
				"bulletSize": 7,
				"hideBulletsCount": 50,
				"lineThickness": 1,
				"title": "r2_f1_m2",
				"useLineColorForBulletBorder": true,
				"valueField": "r2_f1_m2",
				"balloonText": "<span style='font-size:8px;'>[[value]]</span>"
			},{
				"id": "r2_f1_m3",
				"balloon":{
				  "drop":false,
				  "adjustBorderColor":false,
				  "color":"#ffffff"
				},
				"bullet": "round",
				"bulletBorderAlpha": 1,
				"bulletColor": "#FFFFFF",
				"bulletSize": 7,
				"hideBulletsCount": 50,
				"lineThickness": 1,
				"title": "r2_f1_m3",
				"useLineColorForBulletBorder": true,
				"valueField": "r2_f1_m3",
				"balloonText": "<span style='font-size:8px;'>[[value]]</span>"
			},{
				"id": "r2_f2_m1",
				"balloon":{
				  "drop":false,
				  "adjustBorderColor":false,
				  "color":"#ffffff"
				},
				"bullet": "round",
				"bulletBorderAlpha": 1,
				"bulletColor": "#FFFFFF",
				"bulletSize": 7,
				"hideBulletsCount": 50,
				"lineThickness": 1,
				"title": "r2_f2_m1",
				"useLineColorForBulletBorder": true,
				"valueField": "r2_f2_m1",
				"balloonText": "<span style='font-size:8px;'>[[value]]</span>"
			},{
				"id": "r2_f2_m2",
				"balloon":{
				  "drop":false,
				  "adjustBorderColor":false,
				  "color":"#ffffff"
				},
				"bullet": "round",
				"bulletBorderAlpha": 1,
				"bulletColor": "#FFFFFF",
				"bulletSize": 7,
				"hideBulletsCount": 50,
				"lineThickness": 1,
				"title": "r2_f2_m2",
				"useLineColorForBulletBorder": true,
				"valueField": "r2_f2_m2",
				"balloonText": "<span style='font-size:8px;'>[[value]]</span>"
			},{
				"id": "r2_f2_m3",
				"balloon":{
				  "drop":false,
				  "adjustBorderColor":false,
				  "color":"#ffffff"
				},
				"bullet": "round",
				"bulletBorderAlpha": 1,
				"bulletColor": "#FFFFFF",
				"bulletSize": 7,
				"hideBulletsCount": 50,
				"lineThickness": 1,
				"title": "r2_f2_m3",
				"useLineColorForBulletBorder": true,
				"valueField": "r2_f2_m3",
				"balloonText": "<span style='font-size:8px;'>[[value]]</span>"
			},{
				"id": "r2_f3_m1",
				"balloon":{
				  "drop":false,
				  "adjustBorderColor":false,
				  "color":"#ffffff"
				},
				"bullet": "round",
				"bulletBorderAlpha": 1,
				"bulletColor": "#FFFFFF",
				"bulletSize": 7,
				"hideBulletsCount": 50,
				"lineThickness": 1,
				"title": "r2_f3_m1",
				"useLineColorForBulletBorder": true,
				"valueField": "r2_f3_m1",
				"balloonText": "<span style='font-size:8px;'>[[value]]</span>"
			},{
				"id": "r2_f3_m2",
				"balloon":{
				  "drop":false,
				  "adjustBorderColor":false,
				  "color":"#ffffff"
				},
				"bullet": "round",
				"bulletBorderAlpha": 1,
				"bulletColor": "#FFFFFF",
				"bulletSize": 7,
				"hideBulletsCount": 50,
				"lineThickness": 1,
				"title": "r2_f3_m2",
				"useLineColorForBulletBorder": true,
				"valueField": "r2_f3_m2",
				"balloonText": "<span style='font-size:8px;'>[[value]]</span>"
			},{
				"id": "r2_f3_m3",
				"balloon":{
				  "drop":false,
				  "adjustBorderColor":false,
				  "color":"#ffffff"
				},
				"bullet": "round",
				"bulletBorderAlpha": 1,
				"bulletColor": "#FFFFFF",
				"bulletSize": 7,
				"hideBulletsCount": 50,
				"lineThickness": 1,
				"title": "r2_f3_m3",
				"useLineColorForBulletBorder": true,
				"valueField": "r2_f3_m3",
				"balloonText": "<span style='font-size:8px;'>[[value]]</span>"
			},{
				"id": "r3_f1_m1",
				"balloon":{
				  "drop":false,
				  "adjustBorderColor":false,
				  "color":"#ffffff"
				},
				"bullet": "round",
				"bulletBorderAlpha": 1,
				"bulletColor": "#FFFFFF",
				"bulletSize": 7,
				"hideBulletsCount": 50,
				"lineThickness": 1,
				"title": "r3_f1_m1",
				"useLineColorForBulletBorder": true,
				"valueField": "r3_f1_m1",
				"balloonText": "<span style='font-size:8px;'>[[value]]</span>"
			},{
				"id": "r3_f1_m2",
				"balloon":{
				  "drop":false,
				  "adjustBorderColor":false,
				  "color":"#ffffff"
				},
				"bullet": "round",
				"bulletBorderAlpha": 1,
				"bulletColor": "#FFFFFF",
				"bulletSize": 7,
				"hideBulletsCount": 50,
				"lineThickness": 1,
				"title": "r3_f1_m2",
				"useLineColorForBulletBorder": true,
				"valueField": "r3_f1_m2",
				"balloonText": "<span style='font-size:8px;'>[[value]]</span>"
			},{
				"id": "r3_f1_m3",
				"balloon":{
				  "drop":false,
				  "adjustBorderColor":false,
				  "color":"#ffffff"
				},
				"bullet": "round",
				"bulletBorderAlpha": 1,
				"bulletColor": "#FFFFFF",
				"bulletSize": 7,
				"hideBulletsCount": 50,
				"lineThickness": 1,
				"title": "r3_f1_m3",
				"useLineColorForBulletBorder": true,
				"valueField": "r3_f1_m3",
				"balloonText": "<span style='font-size:8px;'>[[value]]</span>"
			},{
				"id": "r3_f2_m1",
				"balloon":{
				  "drop":false,
				  "adjustBorderColor":false,
				  "color":"#ffffff"
				},
				"bullet": "round",
				"bulletBorderAlpha": 1,
				"bulletColor": "#FFFFFF",
				"bulletSize": 7,
				"hideBulletsCount": 50,
				"lineThickness": 1,
				"title": "r3_f2_m1",
				"useLineColorForBulletBorder": true,
				"valueField": "r3_f2_m1",
				"balloonText": "<span style='font-size:8px;'>[[value]]</span>"
			},{
				"id": "r3_f2_m2",
				"balloon":{
				  "drop":false,
				  "adjustBorderColor":false,
				  "color":"#ffffff"
				},
				"bullet": "round",
				"bulletBorderAlpha": 1,
				"bulletColor": "#FFFFFF",
				"bulletSize": 7,
				"hideBulletsCount": 50,
				"lineThickness": 1,
				"title": "r3_f2_m2",
				"useLineColorForBulletBorder": true,
				"valueField": "r3_f2_m2",
				"balloonText": "<span style='font-size:8px;'>[[value]]</span>"
			},{
				"id": "r3_f2_m3",
				"balloon":{
				  "drop":false,
				  "adjustBorderColor":false,
				  "color":"#ffffff"
				},
				"bullet": "round",
				"bulletBorderAlpha": 1,
				"bulletColor": "#FFFFFF",
				"bulletSize": 7,
				"hideBulletsCount": 50,
				"lineThickness": 1,
				"title": "r3_f2_m3",
				"useLineColorForBulletBorder": true,
				"valueField": "r3_f2_m3",
				"balloonText": "<span style='font-size:8px;'>[[value]]</span>"
			},{
				"id": "r3_f3_m1",
				"balloon":{
				  "drop":false,
				  "adjustBorderColor":false,
				  "color":"#ffffff"
				},
				"bullet": "round",
				"bulletBorderAlpha": 1,
				"bulletColor": "#FFFFFF",
				"bulletSize": 7,
				"hideBulletsCount": 50,
				"lineThickness": 1,
				"title": "r3_f3_m1",
				"useLineColorForBulletBorder": true,
				"valueField": "r3_f3_m1",
				"balloonText": "<span style='font-size:8px;'>[[value]]</span>"
			},{
				"id": "r3_f3_m2",
				"balloon":{
				  "drop":false,
				  "adjustBorderColor":false,
				  "color":"#ffffff"
				},
				"bullet": "round",
				"bulletBorderAlpha": 1,
				"bulletColor": "#FFFFFF",
				"bulletSize": 7,
				"hideBulletsCount": 50,
				"lineThickness": 1,
				"title": "r3_f3_m2",
				"useLineColorForBulletBorder": true,
				"valueField": "r3_f3_m2",
				"balloonText": "<span style='font-size:8px;'>[[value]]</span>"
			},{
				"id": "r3_f3_m3",
				"balloon":{
				  "drop":false,
				  "adjustBorderColor":false,
				  "color":"#ffffff"
				},
				"bullet": "round",
				"bulletBorderAlpha": 1,
				"bulletColor": "#FFFFFF",
				"bulletSize": 7,
				"hideBulletsCount": 50,
				"lineThickness": 1,
				"title": "r3_f3_m3",
				"useLineColorForBulletBorder": true,
				"valueField": "r3_f3_m3",
				"balloonText": "<span style='font-size:8px;'>[[value]]</span>"
			},{
				"id": "new_user",
				"balloon":{
				  "drop":false,
				  "adjustBorderColor":false,
				  "color":"#ffffff"
				},
				"bullet": "round",
				"bulletBorderAlpha": 1,
				"bulletColor": "#FFFFFF",
				"bulletSize": 7,
				"hideBulletsCount": 50,
				"lineThickness": 1,
				"title": "new_user",
				"useLineColorForBulletBorder": true,
				"valueField": "new_user",
				"balloonText": "<span style='font-size:8px;'>[[value]]</span>"
			}],
			"chartScrollbar": {
				"graph": "r1_f1_m1",
				"oppositeAxis":false,
				"offset":30,
				"scrollbarHeight": 80,
				"backgroundAlpha": 0,
				"selectedBackgroundAlpha": 0.1,
				"selectedBackgroundColor": "#888888",
				"graphFillAlpha": 0,
				"graphLineAlpha": 0.5,
				"selectedGraphFillAlpha": 0,
				"selectedGraphLineAlpha": 1,
				"autoGridCount":true,
				"color":"#AAAAAA"
			},
			"chartCursor": {
				"pan": true,
				"valueLineEnabled": true,
				"valueLineBalloonEnabled": true,
				"cursorAlpha":1,
				"cursorColor":"#258cbb",
				"limitToGraph":"r1_f1_m1",
				"valueLineAlpha":0.2,
				"valueZoomable":true
			},
			"valueScrollbar":{
			  "oppositeAxis":false,
			  "offset":50,
			  "scrollbarHeight":10
			},
			"categoryField": "date",
			"categoryAxis": {
				"parseDates": true,
				"dashLength": 1,
				"minorGridEnabled": true
			},
			"export": {
				"enabled": true
			},
			"colors":
				['#FF6600', '#FCD202', '#B0DE09', '#0D8ECF', '#2A0CD0', '#CD0D74', '#CC0000', '#00CC00', '#0000CC'
				,'#DDDDDD', '#999999', '#333333', '#990000', '#A8D352', '#ED5E76', '#EFB9CB', '#E6ADEC', '#8E63A9'
				,'#9B1D20', '#3D2B3D', '#635D5C', '#BAEF9B', '#704E2E', '#709176', '#4381C1', '#BDADEA', '#BEA2C2'
				,'#4E4B5C']		
			
			
			});
			
			chart.addListener("rendered", zoomChart);
			
			zoomChart();
	
			function zoomChart() {
				chart.zoomToIndexes(chart.dataProvider.length - 60, chart.dataProvider.length - 1);
			}
		}
		
		function showplot2(data){
			var chart2 = AmCharts.makeChart("chartdiv2", {
			"type": "serial",
			"theme": "light",
			"marginRight": 40,
			"marginLeft": 40,
			"autoMarginOffset": 20,
			"mouseWheelZoomEnabled":true,
			"dataProvider":jsondata_hr, //只能傳進json object
			"legend": {
						"enabled": true,
						"useGraphSettings": true,
						"valueWidth":35,
						"horizontalGap": 10,
						"markerSize": 10,
						"clickMarker": handleLegendClick, //marker指的是前面的圖案
						//"clickLabel": handleLegendClick   //label指的是文字標籤
					},
			
			"dataDateFormat": "YYYY-MM-DD",
			"valueAxes": [{
				"id": "v1",
				"axisAlpha": 0,
				"position": "left",
				"ignoreAxisWidth":true
			}],
			"balloon": {
				"borderThickness": 0.5,
				"shadowAlpha": 0,
				"cornerRadius": 1,
			},
			"graphs": [{
				"id": "r1_f1_m1",
				"balloon":{
				  "drop":false,
				  "adjustBorderColor":false,
				  "color":"#ffffff"
				},
				"bullet": "round",
				"bulletBorderAlpha": 1,
				"bulletColor": "#FFFFFF",
				"bulletSize": 7,
				"hideBulletsCount": 50,
				"lineThickness": 1,
				"title": "r1_f1_m1",
				"useLineColorForBulletBorder": true,
				"valueField": "r1_f1_m1",
				"balloonText": "<span style='font-size:8px;'>[[value]]</span>"
			},{
				"id": "r1_f1_m2",
				"balloon":{
				  "drop":false,
				  "adjustBorderColor":false,
				  "color":"#ffffff"
				},
				"bullet": "round",
				"bulletBorderAlpha": 1,
				"bulletColor": "#FFFFFF",
				"bulletSize": 7,
				"hideBulletsCount": 50,
				"lineThickness": 1,
				"title": "r1_f1_m2",
				"useLineColorForBulletBorder": true,
				"valueField": "r1_f1_m2",
				"balloonText": "<span style='font-size:8px;'>[[value]]</span>"
			},{
				"id": "r1_f1_m3",
				"balloon":{
				  "drop":false,
				  "adjustBorderColor":false,
				  "color":"#ffffff"
				},
				"bullet": "round",
				"bulletBorderAlpha": 1,
				"bulletColor": "#FFFFFF",
				"bulletSize": 7,
				"hideBulletsCount": 50,
				"lineThickness": 1,
				"title": "r1_f1_m3",
				"useLineColorForBulletBorder": true,
				"valueField": "r1_f1_m3",
				"balloonText": "<span style='font-size:8px;'>[[value]]</span>"
			},{
				"id": "r1_f2_m1",
				"balloon":{
				  "drop":false,
				  "adjustBorderColor":false,
				  "color":"#ffffff"
				},
				"bullet": "round",
				"bulletBorderAlpha": 1,
				"bulletColor": "#FFFFFF",
				"bulletSize": 7,
				"hideBulletsCount": 50,
				"lineThickness": 1,
				"title": "r1_f2_m1",
				"useLineColorForBulletBorder": true,
				"valueField": "r1_f2_m1",
				"balloonText": "<span style='font-size:8px;'>[[value]]</span>"
			},{
				"id": "r1_f2_m2",
				"balloon":{
				  "drop":false,
				  "adjustBorderColor":false,
				  "color":"#ffffff"
				},
				"bullet": "round",
				"bulletBorderAlpha": 1,
				"bulletColor": "#FFFFFF",
				"bulletSize": 7,
				"hideBulletsCount": 50,
				"lineThickness": 1,
				"title": "r1_f2_m2",
				"useLineColorForBulletBorder": true,
				"valueField": "r1_f2_m2",
				"balloonText": "<span style='font-size:8px;'>[[value]]</span>"
			},{
				"id": "r1_f2_m3",
				"balloon":{
				  "drop":false,
				  "adjustBorderColor":false,
				  "color":"#ffffff"
				},
				"bullet": "round",
				"bulletBorderAlpha": 1,
				"bulletColor": "#FFFFFF",
				"bulletSize": 7,
				"hideBulletsCount": 50,
				"lineThickness": 1,
				"title": "r1_f2_m3",
				"useLineColorForBulletBorder": true,
				"valueField": "r1_f2_m3",
				"balloonText": "<span style='font-size:8px;'>[[value]]</span>"
			},{
				"id": "r1_f3_m1",
				"balloon":{
				  "drop":false,
				  "adjustBorderColor":false,
				  "color":"#ffffff"
				},
				"bullet": "round",
				"bulletBorderAlpha": 1,
				"bulletColor": "#FFFFFF",
				"bulletSize": 7,
				"hideBulletsCount": 50,
				"lineThickness": 1,
				"title": "r1_f3_m1",
				"useLineColorForBulletBorder": true,
				"valueField": "r1_f3_m1",
				"balloonText": "<span style='font-size:8px;'>[[value]]</span>"
			},{
				"id": "r1_f3_m2",
				"balloon":{
				  "drop":false,
				  "adjustBorderColor":false,
				  "color":"#ffffff"
				},
				"bullet": "round",
				"bulletBorderAlpha": 1,
				"bulletColor": "#FFFFFF",
				"bulletSize": 7,
				"hideBulletsCount": 50,
				"lineThickness": 1,
				"title": "r1_f3_m2",
				"useLineColorForBulletBorder": true,
				"valueField": "r1_f3_m2",
				"balloonText": "<span style='font-size:8px;'>[[value]]</span>"
			},{
				"id": "r1_f3_m3",
				"balloon":{
				  "drop":false,
				  "adjustBorderColor":false,
				  "color":"#ffffff"
				},
				"bullet": "round",
				"bulletBorderAlpha": 1,
				"bulletColor": "#FFFFFF",
				"bulletSize": 7,
				"hideBulletsCount": 50,
				"lineThickness": 1,
				"title": "r1_f3_m3",
				"useLineColorForBulletBorder": true,
				"valueField": "r1_f3_m3",
				"balloonText": "<span style='font-size:8px;'>[[value]]</span>"
			},{
				"id": "r2_f1_m1",
				"balloon":{
				  "drop":false,
				  "adjustBorderColor":false,
				  "color":"#ffffff"
				},
				"bullet": "round",
				"bulletBorderAlpha": 1,
				"bulletColor": "#FFFFFF",
				"bulletSize": 7,
				"hideBulletsCount": 50,
				"lineThickness": 1,
				"title": "r2_f1_m1",
				"useLineColorForBulletBorder": true,
				"valueField": "r2_f1_m1",
				"balloonText": "<span style='font-size:8px;'>[[value]]</span>"
			},{
				"id": "r2_f1_m2",
				"balloon":{
				  "drop":false,
				  "adjustBorderColor":false,
				  "color":"#ffffff"
				},
				"bullet": "round",
				"bulletBorderAlpha": 1,
				"bulletColor": "#FFFFFF",
				"bulletSize": 7,
				"hideBulletsCount": 50,
				"lineThickness": 1,
				"title": "r2_f1_m2",
				"useLineColorForBulletBorder": true,
				"valueField": "r2_f1_m2",
				"balloonText": "<span style='font-size:8px;'>[[value]]</span>"
			},{
				"id": "r2_f1_m3",
				"balloon":{
				  "drop":false,
				  "adjustBorderColor":false,
				  "color":"#ffffff"
				},
				"bullet": "round",
				"bulletBorderAlpha": 1,
				"bulletColor": "#FFFFFF",
				"bulletSize": 7,
				"hideBulletsCount": 50,
				"lineThickness": 1,
				"title": "r2_f1_m3",
				"useLineColorForBulletBorder": true,
				"valueField": "r2_f1_m3",
				"balloonText": "<span style='font-size:8px;'>[[value]]</span>"
			},{
				"id": "r2_f2_m1",
				"balloon":{
				  "drop":false,
				  "adjustBorderColor":false,
				  "color":"#ffffff"
				},
				"bullet": "round",
				"bulletBorderAlpha": 1,
				"bulletColor": "#FFFFFF",
				"bulletSize": 7,
				"hideBulletsCount": 50,
				"lineThickness": 1,
				"title": "r2_f2_m1",
				"useLineColorForBulletBorder": true,
				"valueField": "r2_f2_m1",
				"balloonText": "<span style='font-size:8px;'>[[value]]</span>"
			},{
				"id": "r2_f2_m2",
				"balloon":{
				  "drop":false,
				  "adjustBorderColor":false,
				  "color":"#ffffff"
				},
				"bullet": "round",
				"bulletBorderAlpha": 1,
				"bulletColor": "#FFFFFF",
				"bulletSize": 7,
				"hideBulletsCount": 50,
				"lineThickness": 1,
				"title": "r2_f2_m2",
				"useLineColorForBulletBorder": true,
				"valueField": "r2_f2_m2",
				"balloonText": "<span style='font-size:8px;'>[[value]]</span>"
			},{
				"id": "r2_f2_m3",
				"balloon":{
				  "drop":false,
				  "adjustBorderColor":false,
				  "color":"#ffffff"
				},
				"bullet": "round",
				"bulletBorderAlpha": 1,
				"bulletColor": "#FFFFFF",
				"bulletSize": 7,
				"hideBulletsCount": 50,
				"lineThickness": 1,
				"title": "r2_f2_m3",
				"useLineColorForBulletBorder": true,
				"valueField": "r2_f2_m3",
				"balloonText": "<span style='font-size:8px;'>[[value]]</span>"
			},{
				"id": "r2_f3_m1",
				"balloon":{
				  "drop":false,
				  "adjustBorderColor":false,
				  "color":"#ffffff"
				},
				"bullet": "round",
				"bulletBorderAlpha": 1,
				"bulletColor": "#FFFFFF",
				"bulletSize": 7,
				"hideBulletsCount": 50,
				"lineThickness": 1,
				"title": "r2_f3_m1",
				"useLineColorForBulletBorder": true,
				"valueField": "r2_f3_m1",
				"balloonText": "<span style='font-size:8px;'>[[value]]</span>"
			},{
				"id": "r2_f3_m2",
				"balloon":{
				  "drop":false,
				  "adjustBorderColor":false,
				  "color":"#ffffff"
				},
				"bullet": "round",
				"bulletBorderAlpha": 1,
				"bulletColor": "#FFFFFF",
				"bulletSize": 7,
				"hideBulletsCount": 50,
				"lineThickness": 1,
				"title": "r2_f3_m2",
				"useLineColorForBulletBorder": true,
				"valueField": "r2_f3_m2",
				"balloonText": "<span style='font-size:8px;'>[[value]]</span>"
			},{
				"id": "r2_f3_m3",
				"balloon":{
				  "drop":false,
				  "adjustBorderColor":false,
				  "color":"#ffffff"
				},
				"bullet": "round",
				"bulletBorderAlpha": 1,
				"bulletColor": "#FFFFFF",
				"bulletSize": 7,
				"hideBulletsCount": 50,
				"lineThickness": 1,
				"title": "r2_f3_m3",
				"useLineColorForBulletBorder": true,
				"valueField": "r2_f3_m3",
				"balloonText": "<span style='font-size:8px;'>[[value]]</span>"
			},{
				"id": "r3_f1_m1",
				"balloon":{
				  "drop":false,
				  "adjustBorderColor":false,
				  "color":"#ffffff"
				},
				"bullet": "round",
				"bulletBorderAlpha": 1,
				"bulletColor": "#FFFFFF",
				"bulletSize": 7,
				"hideBulletsCount": 50,
				"lineThickness": 1,
				"title": "r3_f1_m1",
				"useLineColorForBulletBorder": true,
				"valueField": "r3_f1_m1",
				"balloonText": "<span style='font-size:8px;'>[[value]]</span>"
			},{
				"id": "r3_f1_m2",
				"balloon":{
				  "drop":false,
				  "adjustBorderColor":false,
				  "color":"#ffffff"
				},
				"bullet": "round",
				"bulletBorderAlpha": 1,
				"bulletColor": "#FFFFFF",
				"bulletSize": 7,
				"hideBulletsCount": 50,
				"lineThickness": 1,
				"title": "r3_f1_m2",
				"useLineColorForBulletBorder": true,
				"valueField": "r3_f1_m2",
				"balloonText": "<span style='font-size:8px;'>[[value]]</span>"
			},{
				"id": "r3_f1_m3",
				"balloon":{
				  "drop":false,
				  "adjustBorderColor":false,
				  "color":"#ffffff"
				},
				"bullet": "round",
				"bulletBorderAlpha": 1,
				"bulletColor": "#FFFFFF",
				"bulletSize": 7,
				"hideBulletsCount": 50,
				"lineThickness": 1,
				"title": "r3_f1_m3",
				"useLineColorForBulletBorder": true,
				"valueField": "r3_f1_m3",
				"balloonText": "<span style='font-size:8px;'>[[value]]</span>"
			},{
				"id": "r3_f2_m1",
				"balloon":{
				  "drop":false,
				  "adjustBorderColor":false,
				  "color":"#ffffff"
				},
				"bullet": "round",
				"bulletBorderAlpha": 1,
				"bulletColor": "#FFFFFF",
				"bulletSize": 7,
				"hideBulletsCount": 50,
				"lineThickness": 1,
				"title": "r3_f2_m1",
				"useLineColorForBulletBorder": true,
				"valueField": "r3_f2_m1",
				"balloonText": "<span style='font-size:8px;'>[[value]]</span>"
			},{
				"id": "r3_f2_m2",
				"balloon":{
				  "drop":false,
				  "adjustBorderColor":false,
				  "color":"#ffffff"
				},
				"bullet": "round",
				"bulletBorderAlpha": 1,
				"bulletColor": "#FFFFFF",
				"bulletSize": 7,
				"hideBulletsCount": 50,
				"lineThickness": 1,
				"title": "r3_f2_m2",
				"useLineColorForBulletBorder": true,
				"valueField": "r3_f2_m2",
				"balloonText": "<span style='font-size:8px;'>[[value]]</span>"
			},{
				"id": "r3_f2_m3",
				"balloon":{
				  "drop":false,
				  "adjustBorderColor":false,
				  "color":"#ffffff"
				},
				"bullet": "round",
				"bulletBorderAlpha": 1,
				"bulletColor": "#FFFFFF",
				"bulletSize": 7,
				"hideBulletsCount": 50,
				"lineThickness": 1,
				"title": "r3_f2_m3",
				"useLineColorForBulletBorder": true,
				"valueField": "r3_f2_m3",
				"balloonText": "<span style='font-size:8px;'>[[value]]</span>"
			},{
				"id": "r3_f3_m1",
				"balloon":{
				  "drop":false,
				  "adjustBorderColor":false,
				  "color":"#ffffff"
				},
				"bullet": "round",
				"bulletBorderAlpha": 1,
				"bulletColor": "#FFFFFF",
				"bulletSize": 7,
				"hideBulletsCount": 50,
				"lineThickness": 1,
				"title": "r3_f3_m1",
				"useLineColorForBulletBorder": true,
				"valueField": "r3_f3_m1",
				"balloonText": "<span style='font-size:8px;'>[[value]]</span>"
			},{
				"id": "r3_f3_m2",
				"balloon":{
				  "drop":false,
				  "adjustBorderColor":false,
				  "color":"#ffffff"
				},
				"bullet": "round",
				"bulletBorderAlpha": 1,
				"bulletColor": "#FFFFFF",
				"bulletSize": 7,
				"hideBulletsCount": 50,
				"lineThickness": 1,
				"title": "r3_f3_m2",
				"useLineColorForBulletBorder": true,
				"valueField": "r3_f3_m2",
				"balloonText": "<span style='font-size:8px;'>[[value]]</span>"
			},{
				"id": "r3_f3_m3",
				"balloon":{
				  "drop":false,
				  "adjustBorderColor":false,
				  "color":"#ffffff"
				},
				"bullet": "round",
				"bulletBorderAlpha": 1,
				"bulletColor": "#FFFFFF",
				"bulletSize": 7,
				"hideBulletsCount": 50,
				"lineThickness": 1,
				"title": "r3_f3_m3",
				"useLineColorForBulletBorder": true,
				"valueField": "r3_f3_m3",
				"balloonText": "<span style='font-size:8px;'>[[value]]</span>"
			},{
				"id": "new_user",
				"balloon":{
				  "drop":false,
				  "adjustBorderColor":false,
				  "color":"#ffffff"
				},
				"bullet": "round",
				"bulletBorderAlpha": 1,
				"bulletColor": "#FFFFFF",
				"bulletSize": 7,
				"hideBulletsCount": 50,
				"lineThickness": 1,
				"title": "new_user",
				"useLineColorForBulletBorder": true,
				"valueField": "new_user",
				"balloonText": "<span style='font-size:8px;'>[[value]]</span>"
			}],
			"chartScrollbar": {
				"graph": "r1_f1_m1",
				"oppositeAxis":false,
				"offset":30,
				"scrollbarHeight": 80,
				"backgroundAlpha": 0,
				"selectedBackgroundAlpha": 0.1,
				"selectedBackgroundColor": "#888888",
				"graphFillAlpha": 0,
				"graphLineAlpha": 0.5,
				"selectedGraphFillAlpha": 0,
				"selectedGraphLineAlpha": 1,
				"autoGridCount":true,
				"color":"#AAAAAA"
			},
			"chartCursor": {
				"pan": true,
				"valueLineEnabled": true,
				"valueLineBalloonEnabled": true,
				"cursorAlpha":1,
				"cursorColor":"#258cbb",
				"limitToGraph":"r1_f1_m1",
				"valueLineAlpha":0.2,
				"valueZoomable":true
			},
			"valueScrollbar":{
			  "oppositeAxis":false,
			  "offset":50,
			  "scrollbarHeight":10
			},
			"categoryField": "date",
			"categoryAxis": {
				"parseDates": true,
				"dashLength": 1,
				"minorGridEnabled": true
			},
			"export": {
				"enabled": true
			},
			"colors":
				['#FF6600', '#FCD202', '#B0DE09', '#0D8ECF', '#2A0CD0', '#CD0D74', '#CC0000', '#00CC00', '#0000CC'
				,'#DDDDDD', '#999999', '#333333', '#990000', '#A8D352', '#ED5E76', '#EFB9CB', '#E6ADEC', '#8E63A9'
				,'#9B1D20', '#3D2B3D', '#635D5C', '#BAEF9B', '#704E2E', '#709176', '#4381C1', '#BDADEA', '#BEA2C2'
				,'#4E4B5C']
			});
			
			chart2.addListener("rendered", zoomChart);
			
			zoomChart();
	
			function zoomChart() {
				chart2.zoomToIndexes(chart2.dataProvider.length - 60, chart2.dataProvider.length - 1);
			}
		}
		
		//parse tsv to JSON
		function tsv2JSON(tsv){
			//console.log(tsv);
			//console.log(tsv.substr(1,tsv.length-2));
			var tsv=tsv.substr(1,tsv.length-2);
			var lines=tsv.split("\\n");
			var result = [];
			
			for(var i=0;i<lines.length-1;i++){

				var obj = {};
				var currentline=lines[i].split("\\t");
				
				//console.log(lines[i]);
				//console.log(currentline);
				
				obj['date']=currentline[0];
				obj['r1_f1_m1']=currentline[1];
				obj['r1_f1_m2']=currentline[2];
				obj['r1_f1_m3']=currentline[3];
				obj['r1_f2_m1']=currentline[4];
				obj['r1_f2_m2']=currentline[5];
				obj['r1_f2_m3']=currentline[6];
				obj['r1_f3_m1']=currentline[7];
				obj['r1_f3_m2']=currentline[8];
				obj['r1_f3_m3']=currentline[9];
				
				obj['r2_f1_m1']=currentline[10];
				obj['r2_f1_m2']=currentline[11];
				obj['r2_f1_m3']=currentline[12];
				obj['r2_f2_m1']=currentline[13];
				obj['r2_f2_m2']=currentline[14];
				obj['r2_f2_m3']=currentline[15];
				obj['r2_f3_m1']=currentline[16];
				obj['r2_f3_m2']=currentline[17];
				obj['r2_f3_m3']=currentline[18];
				
				obj['r3_f1_m1']=currentline[19];
				obj['r3_f1_m2']=currentline[20];
				obj['r3_f1_m3']=currentline[21];
				obj['r3_f2_m1']=currentline[22];
				obj['r3_f2_m2']=currentline[23];
				obj['r3_f2_m3']=currentline[24];
				obj['r3_f3_m1']=currentline[25];
				obj['r3_f3_m2']=currentline[26];
				obj['r3_f3_m3']=currentline[27];
				obj['new_user']=currentline[28];
				
				//console.log(obj);
				
				result.push(obj);
			}
			//return result; //JavaScript object
			return JSON.stringify(result); //JSON
		}
		
		//use d3 to read tsv data and plot it
		
		var all_data,perdata,jsondata; //用來儲存data的json object : 
									   //{all_data:原始資料,perdata:轉換成百分比的,jsondata:最後要呈現的資料} 
		var plot = d3.text("rfm_123.tsv", function(error, data){
			//console.log(data);
			if(error){
				return console.log(error);
			}
			//alldata
			all_data=JSON.parse(tsv2JSON(JSON.stringify(data)));
			tmp = JSON.stringify(all_data.slice());
			
			//perdata
			perdata = JSON.parse(tmp);
			for(i=0;i<perdata.length;i++){
					var temp_sum = 0;
					for(x in perdata[i]){
						if(x == 'date') continue;
						temp_sum = temp_sum + parseInt(perdata[i][x]);
						//console.log(temp_sum);
					}
					for(x in perdata[i]){
						if(x == 'date') continue;
						perdata[i][x] = (parseInt(perdata[i][x]) / temp_sum).toFixed(3);
						//console.log(perdata[i][x]);
						//console.log(perdata[i][x]);
					}
				}
			
			//jsondata			
			jsondata = JSON.parse(tmp);			
			
			showplot(jsondata);
			//console.log(jsondata);
		});
		
		var all_hr,jsondata_hr;
		var plot2 = d3.text("rfm_123_hr.tsv", function(error, data){
			//console.log(data);
			if(error){
				return console.log(error);
			}
			//jsondata
			all_hr=JSON.parse(tsv2JSON(JSON.stringify(data)));
			
			for(i=0;i<all_hr.length;i++){
				for(x in all_hr[i]){
				
					if(x == 'date') continue;
					if(all_hr[i][x] > 1){
						all_hr[i][x] = "0";
					}else{
						all_hr[i][x] = all_hr[i][x].substr(0,5);
					}					 
				
				}
			}
			
			jsondata_hr = JSON.parse(JSON.stringify(all_hr));
			
			showplot2(jsondata_hr);
			//console.log(jsondata);
		});
		
		
		var r,f,m,index=999;
		//即時取得勾選項目的index
		$(".radio-inline").click(function check(){
			//console.log($(".radio-inline").text());
			//document.getElementById("r1").checked = false;
			
			r = $( "input:checked" ).parent().eq(0).text();
			f = $( "input:checked" ).parent().eq(1).text();
			m = $( "input:checked" ).parent().eq(2).text();
			
			var rr,ff,mm;
			
			//all的話值為0
			if(r=='R1'){rr=1}else if(r=='R2'){rr=2}else if(r=='R3'){rr=3}else{rr=0}
			if(f=='F1'){ff=1}else if(f=='F2'){ff=2}else if(f=='F3'){ff=3}else{ff=0}
			if(m=='M1'){mm=1}else if(m=='M2'){mm=2}else if(m=='M3'){mm=3}else{mm=0}
			
			console.log(rr!=0 && ff!=0 && mm!=0);
			//三個都沒有選All才可以用這個index
			if(rr!=0 && ff!=0 && mm!=0){			//都不等於0(all)
				index = [(rr-1)*9 + (ff-1)*3 + (mm-1)];
			}//一個等於0
			else if( rr==0 && ff!=0 && mm!=0 ){  	//r=all
				index=[];for(var i=1;i<=3;i++){index.push((i-1)*9 + (ff-1)*3 + (mm-1))};
			}else if( rr!=0 && ff==0 && mm!=0 ){   	//f=all
				index=[];for(var i=1;i<=3;i++){index.push((rr-1)*9 + (i-1)*3 + (mm-1))};
			}else if( rr!=0 && ff!=0 && mm==0 ){		//m=all
				index=[];for(var i=1;i<=3;i++){index.push((rr-1)*9 + (ff-1)*3 + (i-1))};
			}//二個等於0
			else if( rr==0 && ff==0 && mm!=0 ){		//r+f=all
				index=[];
				for(var i=1;i<=3;i++){
					for(var j=1;j<=3;j++){
						index.push((i-1)*9 + (j-1)*3 + (mm-1))
					}
				}
			}else if( rr==0 && ff!=0 && mm==0 ){		//r+m=all
				index=[];
				for(var i=1;i<=3;i++){
					for(var j=1;j<=3;j++){
						index.push((i-1)*9 + (ff-1)*3 + (j-1))
					}
				}
			}else if( rr!=0 && ff==0 && mm==0 ){		//f+m=all
				index=[];
				for(var i=1;i<=3;i++){
					for(var j=1;j<=3;j++){
						index.push((rr-1)*9 + (i-1)*3 + (j-1))
					}
				}
			}//三個都是all時,連同new_user一起顯示
			else if( rr==0 && ff==0 && mm==0 ){
				index=[];for(var i=0;i<28;i++){index.push(i)}
			}
			
			/*
			console.log('r='+r);
			console.log('f='+f);
			console.log('m='+m);
			console.log('index='+index);
			*/
			
			//連動在legend處click marker
			$("g[cursor='pointer']").eq(0).find('circle').click();
			$("g[cursor='pointer']").eq(28).find('circle').click();
			
		});
		
		function handleLegendClick(graph) {  //為何這邊要傳入一個不知道是甚麼的graph,上面呼叫的時候又不用傳graph?困惑

		  var chart = graph.chart;
		  var hidden = graph.hidden;	  
		  
		  //console.log(graph);
		  //console.log(chart);
		  //chart.hideGraph(chart.graphs[1]);
		  //alert(chart.graphs[0].hidden);
		  
		  for( var i = 0; i < 28; i++){
			if( !chart.graphs[i].hidden ){        //將有show的先隱藏起來
				chart.hideGraph(chart.graphs[i]);
				console.log("hiding......");
			}
		  }
		  
		  for(var i=0;i<index.length;i++){
			chart.showGraph(chart.graphs[index[i]]);   //將所選取的項目呈現出來
		  }
		  
		  /*
		  //全部翻轉
		  for( var i = 0; i < chart.graphs.length; i++ ) {
			if ( hidden ){
				chart.showGraph(chart.graphs[i]);
			}else{
				chart.hideGraph(chart.graphs[i]);
				}
			}
		  // return false so that default action is canceled
		  return false;
		  */
		  
		}

		var switch_check = 0 ; //用來控制 count和百分比 的switch變數 {0:count,1:percentage}
		var per_data; 	       //用來存百分筆資料的變數		
		
		//控制百分比的切換
		$("#switch_btn").click(function(){
			
			//如果是顯示count的狀態			
			if(switch_check == 0){
				
				switch_check = 1;
				
				if($("#ChromeMonthPicker").val()==""){
					tmp = JSON.stringify(perdata.slice());
					jsondata = JSON.parse(tmp);
				}else{
					
					tmp = JSON.stringify(perdata.slice());
					jsondata = JSON.parse(tmp);
					for(i=jsondata.length-1;i>=0;i--){   //如果用遞增的後面再做splice的時候會影響到後面的index,因此要用遞減的
						if($("#ChromeMonthPicker").val() != jsondata[i]["date"].substr(0,7)){
						jsondata.splice(i,1);
						}
					}
					
				}
				
			}else{
				
				switch_check = 0;
				
				if($("#ChromeMonthPicker").val()==""){
					tmp = JSON.stringify(all_data.slice());
					jsondata = JSON.parse(tmp);
				}else{
					
					tmp = JSON.stringify(all_data.slice());
					jsondata = JSON.parse(tmp);
					for(i=jsondata.length-1;i>=0;i--){   //如果用遞增的後面再做splice的時候會影響到後面的index,因此要用遞減的
						if($("#ChromeMonthPicker").val() != jsondata[i]["date"].substr(0,7)){
						jsondata.splice(i,1);
						}
					}
					
				}
				
			}
			
			showplot(jsondata);
			
		});
		
		
		var y = $('#updateMonth').click(function(){
			
			//console.log($("#ChromeMonthPicker").val());
			//jsondata = copy.slice();
			
			//tmp = JSON.stringify(all_data.slice());
			//jsondata = JSON.parse(tmp);
			
			if(switch_check==0){
				tmp = JSON.stringify(all_data.slice());
				jsondata = JSON.parse(tmp);
			}else{
				tmp = JSON.stringify(perdata.slice());
				jsondata = JSON.parse(tmp);
			}
			
			jsondata_hr = JSON.parse(JSON.stringify(all_hr));
			
			
			if($("#ChromeMonthPicker").val() != ""){
				for(i=jsondata.length-1;i>=0;i--){   //如果用遞增的後面再做splice的時候會影響到後面的index,因此要用遞減的
					if($("#ChromeMonthPicker").val() != jsondata[i]["date"].substr(0,7)){
						jsondata.splice(i,1);
						jsondata_hr.splice(i,1);
					}
				}
			}			
			
			showplot(jsondata);
			showplot2(jsondata_hr);

		});
		
		
		</script>
		
	</body>
</html>